<?xml version="1.0" encoding="UTF-8"?>
<server description="Redis Cache Session Persistence Server">

    <!-- Enable the following features -->
    <featureManager>
        <feature>servlet-4.0</feature>
        <feature>jsp-2.3</feature>
        <feature>sessionCache-1.0</feature>
    </featureManager>

    <!-- Define the host name and ports -->
    <httpEndpoint id="defaultHttpEndpoint" httpPort="9080" httpsPort="9443" host="*" />

    <!-- Automatically expand WAR files and EAR files -->
    <applicationManager autoExpand="true"/>

    <!-- JCache configuration for Redis -->
    <cache id="redisCache" name="redisCache" cacheManagerRef="redisCacheManager"/>

    <!-- Cache Manager configuration -->
    <cacheManager id="redisCacheManager" uri="file:${server.config.dir}/redisson-config.yaml">
        <cachingProvider jCacheLibraryRef="redissonLib"/>
    </cacheManager>

    <!-- Library reference for Redisson -->
    <library id="redissonLib">
        <fileset dir="${server.config.dir}/lib" includes="*.jar"/>
    </library>

    <!-- Session Cache configuration -->
    <httpSessionCache cacheManagerRef="redisCacheManager" libraryRef="redissonLib"/>

    <!-- Session configuration -->
    <httpSession 
        cookieHttpOnly="true"
        cookieSecure="false"
        cookieSameSite="Lax"
        invalidationTimeout="30m"
        reaperPollInterval="2m"
        allowOverflow="true"
        maxInMemorySessionCount="1000"
        writeContents="ALL_SESSION_ATTRIBUTES"
        writeFrequency="END_OF_SERVLET_SERVICE"
        writeInterval="10s"/>

    <!-- Application configuration -->
    <webApplication id="redis-cache" 
                    location="redis-cache.war" 
                    contextRoot="/redistester">
        <classloader commonLibraryRef="redissonLib"/>
    </webApplication>

    <!-- Logging configuration -->
    <logging traceSpecification="*=info:com.example.rediscache.*=all:org.redisson.*=all"/>

</server>